# Clima

## Flutter 위치 기반 & 비동기 처리 핵심 정리

---

### 1️⃣ Geolocator로 현재 위치 가져오기 (강의 140)

**사용 패키지**

`geolocator: ^14.0.2`

**현재 위치 조회**

```dart
final LocationSettings locationSettings = LocationSettings(
  accuracy: LocationAccuracy.high,
  distanceFilter: 100,
);

Position position = await Geolocator.getCurrentPosition(
  locationSettings: locationSettings,
);

```

- `accuracy`: 위치 데이터의 정확도 수준
- `timeLimit`: 허용된 최대 시간 (없을 경우 무제한)

**권한 설정 (Permissio**

- iOS → `ios/Runner/Info.plist`

```xml
<key>NSLocationWhenInUseUsageDescription</key>
<string>This app needs access to location when open.</string>

```

- Android → `android/app/src/main/AndroidManifest.xml`

```xml
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

```

**에러 해결 팁**

- 권한 거부 시: `Settings > Location > 앱명 > Allow only while using the app`
- 에뮬레이터 위치 오류 시: 실제 기기 또는 Chrome Web으로 테스트 권장

---

### 2️⃣ 비동기(Async)와 동기(Sync)의 차이 (강의 141)

**동기(Synchronous)**

모든 작업이 **순차적으로 진행**, 이전 작업이 끝나야 다음으로 넘어감

```dart
print("A");
print("B");
print("C");
// 출력: A → B → C

```

**비동기(Asynchronous)**

시간이 오래 걸리는 작업(API, 파일 I/O 등)을 **대기하지 않고 진행**

```dart
print("A");
Future.delayed(Duration(seconds: 2), () {
  print("B");
});
print("C");
// 출력: A → C → B

```

**핵심 포인트**

- 앱이 “멈추지 않게” 하는 방식
- 시간 초과 시 `TimeoutException` 발생 가능
- 실제 API 호출 시 대부분 async/await로 구현됨

---

### 3️⃣ StatefulWidget의 생명주기 (Life Cycle) (강의 142)

| 단계     | 메서드          | 설명                                                  |
| -------- | --------------- | ----------------------------------------------------- |
| 생성     | `createState()` | StatefulWidget 생성 시 한 번 호출                     |
| 초기화   | `initState()`   | 상태가 위젯 트리에 추가될 때 실행, API 호출 초기 세팅 |
| 빌드     | `build()`       | UI를 화면에 그리는 메서드                             |
| 비활성화 | `deactivate()`  | 트리에서 임시 제거될 때 호출                          |
| 해제     | `dispose()`     | 완전 제거 시 리소스 해제 (컨트롤러/스트림 정리 필수)  |

```dart
@override
void initState() {
  super.initState();
  // API 호출, 리스너 등록 등 초기 설정
}
```

**실무에서 중요 이유**

- `initState()`에서 API 호출 시 위치 정보 불러오기, 초기 데이터 세팅을 수행
- `dispose()`에서 메모리 누수 방지를 위한 리소스 해제

---

### 4️⃣ 예외 처리 & Null Operator (강의 143)

**Try–Catch 예외 처리**

```dart
try {
  double value = double.parse('abc'); // 예외 발생
} catch (e) {
  print('에러 발생: $e');
}

```

- 예외: 프로그램 실행 중 발생하는 에러
- API 호출 시 네트워크 실패나 데이터 파싱 에러에 사용됨

**Null Operator**

```dart
String? nickname;
nickname ??= 'Guest';

```

- `?` : null 허용
- `??=` : null일 경우에만 값 대입

**실전 활용**

- API 응답이 없거나 null일 때 대체값 설정
- “가입되지 않은 사용자” 등 예외 처리 가능

---

### 5️⃣ HTTP 통신과 API 요청 (강의 145–146)

**API란?**

> Application Programming Interface
>
> 앱과 서버가 “대화”하기 위한 규칙 집합

| 종류        | 설명             | 예시                    |
| ----------- | ---------------- | ----------------------- |
| Web API     | 웹 데이터 교환   | OpenWeather, Kakao Map  |
| Library API | 함수/위젯 제공   | Flutter Material        |
| OS API      | 시스템 기능 제어 | Android GPS, iOS Camera |

**HTTP 패키지 사용**

```yaml
http: ^1.6.0
```

```dart
void getData() async {
  Response response = await get(
    Uri.parse('https://samples.openweathermap.org/data/2.5/weather?lat=35&lon=139&appid=b6907d289e10d714a6e88b30761fae22'),
  );

  if (response.statusCode == 200) {
    print(response.body);
  } else {
    print(response.statusCode);
  }
}

```

**Status Code 정리**

| 코드 | 의미            |
| ---- | --------------- |
| 1xx  | 정보성 응답     |
| 2xx  | 요청 성공       |
| 3xx  | 리다이렉션 필요 |
| 4xx  | 클라이언트 오류 |
| 5xx  | 서버 오류       |

**핵심 요약**

- Flutter 앱(클라이언트) → 서버로 요청 → JSON 응답 수신
- `await`과 `try-catch`로 비동기 요청 관리
- `statusCode`로 통신 성공 여부를 판단
